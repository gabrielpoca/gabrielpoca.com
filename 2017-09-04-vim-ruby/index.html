<html class="min-h-full h-full w-full" lang="en"><head><title>Gabriel Poça | How to program Vim using Ruby</title><meta content="Gabriel Poça | How to program Vim using Ruby" name="title"><meta content="How to program Vim using Ruby" name="description"><meta content="website" property="og:type"><meta content="https://gabrielpoca.com/2017-09-04-vim-ruby/index.html" property="og:url"><meta content="Gabriel Poça | How to program Vim using Ruby" property="og:title"><meta content="How to program Vim using Ruby" property="og:description"><meta content="https://gabrielpoca.com/https://gabrielpoca.com/2017-09-04-vim-ruby/seo.png" property="og:image"><meta content="summary_large_image" property="twitter:card"><meta content="https://gabrielpoca.com/2017-09-04-vim-ruby/index.html" property="twitter:url"><meta content="Gabriel Poça | How to program Vim using Ruby" property="twitter:title"><meta content="How to program Vim using Ruby" property="twitter:description"><meta content="https://gabrielpoca.com/https://gabrielpoca.com/2017-09-04-vim-ruby/seo.png" property="twitter:image"><link href="/icon.png" rel="icon" type="image/png"><meta content="text/html; charset=utf-8" http-equiv="Content-Type"><meta content="width=device-width, initial-scale=1.0" name="viewport"><link rel="stylesheet"  href="/global-LSjaseDdhYQReak1qfVEbw==.css" />
<link rel="stylesheet"  href="/site--Z1K36JV3z4XqzIgy-g8zw==.css" />
</head><body class="overscroll-none antialiased font-sans min-h-full h-full overflow-x-hidden w-full"><nav class="flex justify-end space-x-3 px-4 uppercase tracking-wide h-16 items-center z-40 relative text-xs font-bold md:px-8 md:space-x-4 md:text-sm text-my-purple"><a href="/" class="opacity-60">Home</a><a href="/books" class="opacity-60">Reading</a><a href="/music" class="opacity-60">Music</a><a href="/now" class="opacity-60">Now</a><a href="/about" class="opacity-60">About</a></nav><article class="bg-black text-my-white h-entry"><div class="text-center relative flex items-center justify-center -mt-16" style="height:80vh"><h1 class="p-name mb-8 text-4xl z-20 relative mx-auto px-8 sm:text-5xl sm:px-16">How to program Vim using Ruby</h1></div><div class="mx-auto py-8 px-6 sm:max-w-screen-sm"><div class="prose max-w-none prose-lg e-content"><p>I recently started working in an Angular project where I’m not able to use <a href="https://github.com/tpope/vim-projectionist">vim-projectionist</a> to navigate the code. vim-projectionist is awesome, and I’ve grown used to it. Searching for files by name, in a code base with hundreds of files, started to become painful and I needed an alternative. Because I couldn’t find a plug-in that satisfied my needs, I decided to do it myself. In this article, I hope to demonstrate how you can program Vim using Ruby.</p><p>Let’s say that you have an HTML file that looks like this:</p><pre><code class="html">...
&lt;div class=&quot;timepicker&quot;&gt;
  &lt;timepicker&gt; ... &lt;/timepicker&gt;
&lt;/div&gt;
...</code></pre><p>When the cursor is on line two or four (the <code class="inline">timepicker</code> tag), you want to trigger a shortcut that opens the JavaScript file for the directive <code class="inline">timepicker</code>.</p><h2>Ruby to the rescue</h2><p>In this project, every directive is in the folder <code class="inline">javascript/directives/</code>, where the directive’s name is also the file’s name. If the name has more than one word, such as <em>chart-timepicker</em>, the file name would be snake case: <em>chart_timepicker</em>.</p><p>I’m assuming you don’t know enough VimScript to make this work (I don’t), but fear not, if you compiled Vim with Ruby support, this will be enough:</p><pre><code class="ruby">function! AngularTemplateToDirective()
ruby &lt;&lt; EOF
  @buffer = VIM::Buffer.current # get current bufer
  match = @buffer.line.match(/&lt;\/?([\w-]+)/) # match current line

  if match
    directive = match[1].gsub(&quot;-&quot;, &quot;_&quot;) # get directive&#39;s file name
    VIM.command(&quot;:e javascript/directives/#{directive}.js&quot;) # open file
  end
EOF
endfunction

autocmd BufRead,BufNewFile *assets/templates*.html nnoremap &lt;silent&gt; &lt;C-]&gt; :call AngularTemplateToDirective()&lt;cr&gt;</code></pre><p>It’s a Vim function that you can trigger with <code class="inline">C-]</code> or call with <code class="inline">:call AngularTemplateToDirective()</code> (or map to a shortcut). Notice that it uses a module called <code class="inline">VIM</code> on line three. That module comes from Vim and it allows us to control it from the Ruby. If you want to learn more use <code class="inline">:help ruby</code> inside Vim.</p><p>This function fetches the current buffer and the current line. If the line matches an HTML tag (something like <code class="inline">&lt;timepicker&gt;</code> , <code class="inline">&lt;/timepicker&gt;</code> or <code class="inline">&lt;timepicker something&gt;</code>), it takes the tag’s name, turns it to snakecase, and opens the corresponding directive’s file.</p><p>Cool right? Five years using Vim and there’s still so much to learn!</p><h2>A little more advanced</h2><p>With the function above, you can open directives from the HTML. How nice would it be to open CSS files from the HTML as well?</p><p>Taking the previous HTML example, when I’m in a line with <code class="inline">class=&quot;timepicker&quot;</code> I want to open the <a href="http://getbem.com/">BEM</a> component named <code class="inline">timepicker</code> that, by convention, sits in <code class="inline">stylesheets/components/timepicker.scss</code>.</p><p>Building on the previous implementation, you first check if the current line contains <code class="inline">class=&quot;</code>, if not then look for the tag using the code from before. If it does match, you extract the component’s name from the class, turn it into snake case and open the file:</p><pre><code class="ruby">function! AngularTemplateToDirectiveOrCSS()
ruby &lt;&lt; EOF
  @buffer = VIM::Buffer.current

  if @buffer.line.include?(&quot;class=&quot;)
    match = @buffer.line.match(/class=&quot;([\w-]+)&quot;/)

    if match
      file = match[1].split(&quot;__&quot;)[0].split(&quot;--&quot;)[0].gsub(&quot;-&quot;, &quot;_&quot;)
      VIM.command(&quot;:e app/assets/stylesheets/application_nsx/components/#{file}.scss&quot;)
    end
  else
    match = @buffer.line.match(/&lt;\/?([\w\-]+)/)

    if match
      directive = match[1].gsub(&quot;-&quot;, &quot;_&quot;)
      VIM.command(&quot;:e app/assets/javascripts/angular/directives/#{directive}.js&quot;)
    end
  end
EOF
endfunction</code></pre><p>I know that this code could be better, but I’m not concerned with that because it’s part of my Vim configuration, I’m always changing it, and it actually works!</p><p>I hope that you’ve found something new in this blog post. If you’re looking for more ideas for your Vim setup, check out <a href="https://subvisual.co/blog/posts/133-super-powered-vim-part-i-projections/">this blog post from Miguel</a>.</p></div></div><span class="h-card hidden p-author"><a class="p-name u-url" href="/" rel="author me">Gabriel Poça</a><a class="u-photo" href="/icon.png"></a><span class="p-note">Professional software engineer / amateur music maker / avid reader in the process of learning everything I can.</span></span><div class="hidden"><a class="u-url" href="/2017-09-04-vim-ruby/index.html">How to program Vim using Ruby</a><time class="dt-published" datetime="2017-09-04T00:00:00-00:00">2017-09-04</time></div></article><footer class="py-20 items-end text-xs sm:text-sm bg-black"><div class="bg-my-purple mx-auto px-4 py-10 md:p-8 md:rounded md:container"><div class="flex flex-col sm:flex-row sm:flex-start"><div class="border-2 border-my-purple-darker rounded-full w-24 h-24 overflow-hidden flex-shrink-0 mb-4 sm:mx-auto sm:mb-0"><img src="/_includes/eu-41840077-400w.jpg" srcset="/_includes/eu-41840077-100w.jpg 100w, /_includes/eu-41840077-200w.jpg 200w, /_includes/eu-41840077-300w.jpg 300w, /_includes/eu-41840077-400w.jpg 400w" class="w-full h-full"/></div><div class="flex-grow sm:ml-8"><p class="font-bold mb-1">Hey! <br /> Thanks for stopping by.</p><p class="flex-grow">And feel free to reach out to me on <a href="https://twitter.com/gabrielgpoca" rel="noopener noreferrer" target="_blank" class="underline underline-current-color text-hover-none">Twitter</a> or <a class="underline underline-current-color text-hover-none" href="mailto:mail@gabrielpoca.com">e-mail</a>.<br />I'm always available to listen, talk, share, or brainstorm.</p><p class="flex-grow">For more information see the <a href="/about" class="underline underline-current-color text-hover-none">about page</a>.</p><p class="flex-grow">You can subscribe to this blog using <a href="/rss.xml" class="underline underline-current-color text-hover-none">RSS</a>.</p></div></div></div></footer><span class="h-card hidden p-author"><a class="p-name u-url" href="/" rel="author me">Gabriel Poça</a><a class="u-photo" href="/icon.png"></a><span class="p-note">Professional software engineer / amateur music maker / avid reader in the process of learning everything I can.</span></span><script data-goatcounter="https://gabrielpoca.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script><link href="https://github.com/gabrielpoca" rel="me" /><link rel="webmention" href="https://webmention.io/gabrielpoca.com/webmention" /><link rel="pingback" href="https://webmention.io/gabrielpoca.com/xmlrpc" /></body></html>