<html class="min-h-full h-full w-full" lang="en"><head><title>Gabriel Poça | Adding Netlify CMS to a website built with Still outside of Netlify</title><meta content="Gabriel Poça | Adding Netlify CMS to a website built with Still outside of Netlify" name="title"><meta content="Adding Netlify CMS to a website built with Still outside of Netlify" name="description"><meta content="website" property="og:type"><meta content="https://gabrielpoca.com/2021-10-28-adding-netlify-cms-to-a-website-built-with-still-outside-of-netlify/index.html" property="og:url"><meta content="Gabriel Poça | Adding Netlify CMS to a website built with Still outside of Netlify" property="og:title"><meta content="Adding Netlify CMS to a website built with Still outside of Netlify" property="og:description"><meta content="https://gabrielpoca.com/https://gabrielpoca.com/2021-10-28-adding-netlify-cms-to-a-website-built-with-still-outside-of-netlify/seo.png" property="og:image"><meta content="summary_large_image" property="twitter:card"><meta content="https://gabrielpoca.com/2021-10-28-adding-netlify-cms-to-a-website-built-with-still-outside-of-netlify/index.html" property="twitter:url"><meta content="Gabriel Poça | Adding Netlify CMS to a website built with Still outside of Netlify" property="twitter:title"><meta content="Adding Netlify CMS to a website built with Still outside of Netlify" property="twitter:description"><meta content="https://gabrielpoca.com/https://gabrielpoca.com/2021-10-28-adding-netlify-cms-to-a-website-built-with-still-outside-of-netlify/seo.png" property="twitter:image"><link href="/icon.png" rel="icon" type="image/png"><meta content="text/html; charset=utf-8" http-equiv="Content-Type"><meta content="width=device-width, initial-scale=1.0" name="viewport"><link rel="stylesheet"  href="/global-6gZG2tczcT3JAwqDe3EZkA==.css" />
<link rel="stylesheet"  href="/site--Z1K36JV3z4XqzIgy-g8zw==.css" />
</head><body class="overscroll-none antialiased font-sans min-h-full h-full overflow-x-hidden w-full"><nav class="flex justify-end space-x-3 px-4 uppercase tracking-wide h-16 items-center z-40 relative text-xs font-bold md:px-8 md:space-x-4 md:text-sm text-my-purple"><a href="/" class="opacity-60">Home</a><a href="/books" class="opacity-60">Reading</a><a href="/music" class="opacity-60">Music</a><a href="/now" class="opacity-60">Now</a><a href="/about" class="opacity-60">About</a></nav><article class="bg-black text-my-white h-entry"><div class="text-center relative flex items-center justify-center -mt-16" style="height:80vh"><h1 class="p-name mb-8 text-4xl z-20 relative mx-auto px-8 sm:text-5xl sm:px-16">Adding Netlify CMS to a website built with Still outside of Netlify</h1></div><div class="mx-auto py-8 px-6 sm:max-w-screen-sm"><div class="prose max-w-none prose-lg e-content"><p>A couple of days ago I added <a href="https://www.netlifycms.org/">Netlify CMS</a> to <a href="https://subvisual.com/blog/">Subvisual’s blog</a>. Our blog posts are written in markdown and published through git, so non-developers were always limited by the availability of developers to publish and make updates. With Netlify CMS, we can still use git and markdown, but at the same time have a web interface with a rich editor to get posts online.</p><p>I found the experience of using Netlify CMS so good that I had to get it on <a href="https://gabrielpoca.com">my blog</a>. But, while Subvisual’s blog is built with Gatsby and deployed to Netlify, mine is built with <a href="https://stillstatic.io">Still</a> and deployed to Github Pages, so getting it up and running is not as straightforward.</p><h2>Setup</h2><p><em>If you don’t have a website built with Still, check out the <a href="https://hexdocs.pm/still/getting_started.html">getting started</a> page.</em></p><p>From the <a href="https://www.netlifycms.org/docs/add-to-your-site/">docs</a>, we know that the first step is to put an HTML file somewhere to serve as the entrypoint for Netlify CMS. I’ve added mine to <code class="inline">priv/site/admin/index.html</code> and pasted the contents from the docs:</p><pre><code class="html">&lt;!doctype html&gt;
&lt;html&gt;
&lt;head&gt;
  &lt;meta charset=&quot;utf-8&quot; /&gt;
  &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot; /&gt;
  &lt;title&gt;Content Manager&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
  &lt;!-- Include the script that builds the page and powers Netlify CMS --&gt;
  &lt;script src=&quot;https://unpkg.com/netlify-cms@^2.0.0/dist/netlify-cms.js&quot;&gt;&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre><p>By default, Still doesn’t know what to do with this file, so we’ll update <code class="inline">config/config.exs</code> and add the <code class="inline">admin</code> folder to the <code class="inline">pass_through_copy</code>, which will copy the folder over to the generated website.</p><pre><code class="elixir">config :still,
  pass_through_copy:  [&quot;admin&quot;]</code></pre><p>Netlify CMS will be available in <code class="inline">http://localhost:3000/admin</code>, but we still have to configure it.</p><h2>Configuration</h2><p>Create a <code class="inline">config.yml</code> next to the <code class="inline">index.html</code>. This file will already be copied over to the generated website because of the config we wrote previously. I’m only going to address some parts of the config, but you can see the whole <a href="https://github.com/gabrielpoca/gabrielpoca.com/blob/master/priv/site/admin/config.yml">config on Github</a>.</p><p>The first part is to configure the backend:</p><pre><code class="yml">backend:
  name: github
  repo: gabrielpoca/gabrielpoca.com
  base_url: https://auth.gabrielpoca.com</code></pre><p>The interesting part is the <code class="inline">base_url</code>, which points to a service I deployed. If I was using Netlify this would not be necessary. But I’ll address that later.</p><p>Next, I defined two collections: blog posts and book reviews. They are pretty similar, but the blog posts collection creates a folder per blog post. The trick is accomplished with the <code class="inline">path</code> option. The relevant sections:</p><pre><code class="yml">media_folder: &#39;&#39;
public_folder: &#39;&#39;

collections:
  - name: &#39;post&#39;
    label: &#39;Post&#39;
    folder: &#39;priv/site/blog&#39;
    create: true
    slug: &#39;index&#39;
    media_folder: &#39;&#39;
    public_folder: &#39;&#39;
    path: &#39;{{year}}-{{month}}-{{day}}-{{title}}/{{slug}}&#39;
    fields:
      - name: &#39;layout&#39;
        widget: &#39;hidden&#39;
        default: &quot;_includes/post_layout.slime&quot;
      - name: &#39;tag&#39;
        widget: &#39;hidden&#39;
        default: [&quot;post&quot;]
      - label: &#39;Cover&#39;
        name: &#39;cover&#39;
        widget: &#39;image&#39;
        allow_multiple: false
        required: false
      - label: &#39;Title&#39;
        name: &#39;title&#39;
        widget: &#39;string&#39;
      - label: &#39;Publish Date&#39;
        name: &#39;date&#39;
        widget: &#39;date&#39;
        format: &#39;YYYY-MM-DD&#39;
      - label: &#39;Body&#39;
        name: &#39;body&#39;
        widget: &#39;markdown&#39;</code></pre><p>Notice the <code class="inline">hidden</code> fields. Those will be included in generated frontmatter and I’ve set the mandatory options for each collection. Any image I upload will be placed next to the <code class="inline">index.md</code> file, inside each post’s folder This allows me to easily reference them from markdown with a relative path.</p><h2>Authentication</h2><p>For Subvisual’s website, I’ve used Netlify’s Identity service, which allows people without a Github account to contribute to our blog. This removes developers from the process and makes publishing available to everyone on the team.</p><p>For my website, I only want to authenticate using Github, but it’s not that simple because Github requires a <a href="https://github.com/netlify/netlify-cms/issues/663#issuecomment-335023723">server for authentication</a>. I can’t use the one provided by Netlify so I found <a href="https://github.com/vencax/netlify-cms-github-oauth-provider">netlify-cms-github-oauth-provider</a> which reverse-engineered the implementation of Netlify’s server, which means we don’t have to write a custom backend for Netlify CMS.</p><p>I won’t go into details on how I deploy and manage my services, but I think these environment variables are relevant:</p><pre><code>REDIRECT_URL=https://auth.gabrielpoca.com/callback
SCOPES=public_repo</code></pre><p>The <code class="inline">REDIRECT_URL</code> has to point to the auth server and the <code class="inline">SCOPES</code> is limited to <code class="inline">public_repo</code> because I didn’t feel comfortable having an Oauth App with full access to every repo. The <code class="inline">public_repo</code> scope makes it safer.</p><p>I guess anyone can use my server but I honestly don’t recommend it.</p></div></div><span class="h-card hidden p-author"><a class="p-name u-url" href="/" rel="author me">Gabriel Poça</a><a class="u-photo" href="/icon.png"></a><span class="p-note">Professional software engineer / amateur music maker / avid reader in the process of learning everything I can.</span></span><div class="hidden"><a class="u-url" href="/2021-10-28-adding-netlify-cms-to-a-website-built-with-still-outside-of-netlify/index.html">Adding Netlify CMS to a website built with Still outside of Netlify</a><time class="dt-published" datetime="2021-10-28T00:00:00-00:00">2021-10-28</time></div></article><footer class="py-20 items-end text-xs sm:text-sm bg-black"><div class="bg-my-purple mx-auto px-4 py-10 md:p-8 md:rounded md:container"><div class="flex flex-col sm:flex-row sm:flex-start"><div class="border-2 border-my-purple-darker rounded-full w-24 h-24 overflow-hidden flex-shrink-0 mb-4 sm:mx-auto sm:mb-0"><img src="/_includes/eu-41840077-400w.jpg" srcset="/_includes/eu-41840077-100w.jpg 100w, /_includes/eu-41840077-200w.jpg 200w, /_includes/eu-41840077-300w.jpg 300w, /_includes/eu-41840077-400w.jpg 400w" class="w-full h-full"/></div><div class="flex-grow sm:ml-8"><p class="font-bold mb-1">Hey! <br /> Thanks for stopping by.</p><p class="flex-grow">And feel free to reach out to me on <a href="https://twitter.com/gabrielgpoca" rel="noopener noreferrer" target="_blank" class="underline underline-current-color text-hover-none">Twitter</a> or <a class="underline underline-current-color text-hover-none" href="mailto:mail@gabrielpoca.com">e-mail</a>.<br />I'm always available to listen, talk, share, or brainstorm.</p><p class="flex-grow">For more information see the <a href="/about" class="underline underline-current-color text-hover-none">about page</a>.</p><p class="flex-grow">You can subscribe to this blog using <a href="/rss.xml" class="underline underline-current-color text-hover-none">RSS</a>.</p></div></div></div></footer><span class="h-card hidden p-author"><a class="p-name u-url" href="/" rel="author me">Gabriel Poça</a><a class="u-photo" href="/icon.png"></a><span class="p-note">Professional software engineer / amateur music maker / avid reader in the process of learning everything I can.</span></span><script data-goatcounter="https://gabrielpoca.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script><link href="https://github.com/gabrielpoca" rel="me" /><link rel="webmention" href="https://webmention.io/gabrielpoca.com/webmention" /><link rel="pingback" href="https://webmention.io/gabrielpoca.com/xmlrpc" /></body></html>