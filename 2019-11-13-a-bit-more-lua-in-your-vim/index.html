<html class="min-h-full h-full w-full dark" lang="en"><head><title>Gabriel Poça | A bit more lua in your vim</title><meta content="Gabriel Poça | A bit more lua in your vim" name="title"><meta content="A bit more lua in your vim" name="description"><meta content="website" property="og:type"><meta content="https://gabrielpoca.com/2019-11-13-a-bit-more-lua-in-your-vim/index.html" property="og:url"><meta content="Gabriel Poça | A bit more lua in your vim" property="og:title"><meta content="A bit more lua in your vim" property="og:description"><meta content="https://gabrielpoca.com/https://gabrielpoca.com/2019-11-13-a-bit-more-lua-in-your-vim/seo.png" property="og:image"><meta content="summary_large_image" property="twitter:card"><meta content="https://gabrielpoca.com/2019-11-13-a-bit-more-lua-in-your-vim/index.html" property="twitter:url"><meta content="Gabriel Poça | A bit more lua in your vim" property="twitter:title"><meta content="A bit more lua in your vim" property="twitter:description"><meta content="https://gabrielpoca.com/https://gabrielpoca.com/2019-11-13-a-bit-more-lua-in-your-vim/seo.png" property="twitter:image"><link href="/icon.png" rel="icon" type="image/png"><meta content="text/html; charset=utf-8" http-equiv="Content-Type"><meta content="width=device-width, initial-scale=1.0" name="viewport"><link rel="stylesheet"  href="/global-a3t2m3FQIGbduTQseQ2LOQ==.css" />
<link rel="stylesheet"  href="/site-mEL6LQbJJlCImN4ZkVYbKg==.css" />
</head><body class="overscroll-none antialiased font-sans min-h-full h-full overflow-x-hidden w-full bg-black-light text-my-white"><header class="flex justify-between px-4 md_px-8 items-center absolute top-0 left-0 w-full z-20 text-my-purple"><a href="/" class="flex items-center -mt-1"><img src="/_includes/me small-109857605-256w.png" srcset="/_includes/me small-109857605-64w.png 64w, /_includes/me small-109857605-128w.png 128w, /_includes/me small-109857605-192w.png 192w, /_includes/me small-109857605-256w.png 256w" class="w-8 mr-3"/><span class="invisible sm_visible text-sm font-bold">Gabriel Poça</span></a><nav class="flex justify-end space-x-2 sm_space-x-5 uppercase tracking-widest h-16 items-center z-10 relative text-xs font-bold"><a href="/" class="font-normal">Home</a><a href="/books" class="font-normal">Reading</a><a href="/music" class="font-normal">Music</a><a href="/now" class="font-normal">Now</a><a href="/about" class="font-normal">About</a></nav></header><article><div class="text-center relative flex items-center justify-center" style="height:85vh"><h1 class="mb-8 text-4xl font-bold z-20 relative px-8 max-w-screen-lg sm_text-5xl">A bit more lua in your vim</h1></div><div class="container pb-32 pt-12"><h2 class="mb-6 section-heading">Blog Post</h2><div class="prose max-w-none prose-lg e-content"><p>Following up on the <a href="https://gabrielpoca.com/2019-11-02-a-little-bit-of-lua-in-your-vim/">previous entry about lua in vim</a>, in this one I document other ways in which I used lua to improve my setup.</p><p>Anyone using Neovim should know that it has support for floating windows: real windows that can float around. You can do all kinds of cool stuff with it. Here it is in action:</p><blockquote class="twitter-tweet tw-align-center"><p lang="en" dir="ltr"><a href="https://twitter.com/hashtag/neovim?src=hash&amp;ref_src=twsrc%5Etfw">#neovim</a> floating window test with vim-iced (part 2)<br>Floating debugger info<a href="https://t.co/wAITDpmvip">https://t.co/wAITDpmvip</a><a href="https://twitter.com/hashtag/clojure?src=hash&amp;ref_src=twsrc%5Etfw">#clojure</a> <a href="https://t.co/5lebGKybiD">pic.twitter.com/5lebGKybiD</a></p>&mdash; 飯塚将志@にびいろClojure (@uochan) <a href="https://twitter.com/uochan/status/1101445517865771013?ref_src=twsrc%5Etfw">March 1, 2019</a></blockquote><p>So this is how the story begins: one day my friend, and teammate, <a href="https://twitter.com/naps62">Miguel</a> was showing me something on his computer, when I saw him doing something like this:</p><p><a href="https://asciinema.org/a/278565"><img src="https://asciinema.org/a/278565.svg" alt="asciicast" /></a></p><p>He was opening fzf inside a floating window! I immediately ran to my desk and copied the code that does this from his dotfiles. The relevant parts are <a href="https://github.com/naps62/dotfiles/blob/b6df1166ce3b65ab408147a58201aa9c2cccd691/config/nvim/rc/functions.vim#L69-L87">here</a> and <a href="https://github.com/naps62/dotfiles/blob/f5a3ed135ce210ae3b29268b6122cb5d863375cc/config/nvim/rc/plugins.vim#L226">here</a>. He got it somewhere from the Github.</p><p>I was in love with this for a while!… Until I realized that it didn’t work great when I was using Vim in smaller tmux splits. I need something more “intelligent” that took into account the editor’s size. Since my VimScript skills are non-existent, I replaced his implementation with Lua.</p><p>Here’s what I want:</p><ul><li>if the editor is small (when I’m in a split with 1/4 of the screen’s size) it uses a full window instead of a floating one.</li><li>the floating window’s width is 90% of the editor’s width, but if the editor’s width is small, it uses full width minus 4 columns from each side.</li><li>a floating window’s height is 3/4 of the editor’s height to a max of 30 lines.</li></ul><p>The code, with comments, so it’s easier to understand:</p><pre><code class="lua">function NavigationFloatingWin()
  -- get the editor&#39;s max width and height
  local width = vim.api.nvim_get_option(&quot;columns&quot;)
  local height = vim.api.nvim_get_option(&quot;lines&quot;)

  -- create a new, scratch buffer, for fzf
  local buf = vim.api.nvim_create_buf(false, true)
  vim.api.nvim_buf_set_option(buf, &#39;buftype&#39;, &#39;nofile&#39;)

  -- if the editor is big enough
  if (width &gt; 150 or height &gt; 35) then
    -- fzf&#39;s window height is 3/4 of the max height, but not more than 30
    local win_height = math.min(math.ceil(height * 3 / 4), 30)
    local win_width

    -- if the width is small
    if (width &lt; 150) then
      -- just subtract 8 from the editor&#39;s width
      win_width = math.ceil(width - 8)
    else
      -- use 90% of the editor&#39;s width
      win_width = math.ceil(width * 0.9)
    end

    -- settings for the fzf window
    local opts = {
      relative = &quot;editor&quot;,
      width = win_width,
      height = win_height,
      row = math.ceil((height - win_height) / 2),
      col = math.ceil((width - win_width) / 2)
    }

    -- create a new floating window, centered in the editor
    local win = vim.api.nvim_open_win(buf, true, opts)
  end
end</code></pre><p>To make it work, place the code in a file such as <code class="inline">~/.config/nvim/lua/navigation/init.lua</code>, and in your vim configuration put something like this:</p><pre><code class="vim">&quot; load lua functions for navigation
lua require(&quot;navigation&quot;)
let g:fzf_layout = { &#39;window&#39;: &#39;lua NavigationFloatingWin()&#39; }</code></pre><p>Once again, I know that you can do this with VimScript, but I can’t. And, because I know there are more like me out there, I hope this helps you, and my future self as well.</p></div></div></article><div class="h-4 bg-fuchsia-darker w-full"></div><div class="h-4 bg-fuchsia-dark w-full"></div><footer class="relative flex footer-bg-color text-sm"><img src="/_includes/footer/bg-27398931-11568w.jpg" srcset="/_includes/footer/bg-27398931-2892w.jpg 2892w, /_includes/footer/bg-27398931-5784w.jpg 5784w, /_includes/footer/bg-27398931-8676w.jpg 8676w, /_includes/footer/bg-27398931-11568w.jpg 11568w" class="absolute bottom-0 left-0 h-full object-left-bottom w-full object-cover xl_object-contain"/><div class="relative container pt-28 pb-52 sm_pt-40 sm_pb-60"><p class="font-bold mb-1">Hey! <br /> Thanks for stopping by.</p><p class="flex-grow">And feel free to reach out to me on <a href="https://twitter.com/gabrielgpoca" rel="noopener noreferrer" target="_blank" class="underline underline-current-color text-hover-none">Twitter</a> or <a class="underline underline-current-color text-hover-none" href="mailto:mail@gabrielpoca.com">e-mail</a>.<br />I'm always available to listen, talk, share, or brainstorm.</p><p class="flex-grow">For more information see the <a href="/about" class="underline underline-current-color text-hover-none">about page</a>.</p><p class="flex-grow">You can subscribe to this blog using <a href="/rss.xml" class="underline underline-current-color text-hover-none">RSS</a>.</p></div></footer><script data-goatcounter="https://gabrielpoca.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script></body></html>