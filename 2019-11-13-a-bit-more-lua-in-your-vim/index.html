<html class="min-h-full h-full w-full" lang="en"><head><title>Gabriel Poça | A bit more lua in your vim</title><meta content="Gabriel Poça | A bit more lua in your vim" name="title"><meta content="A bit more lua in your vim" name="description"><meta content="website" property="og:type"><meta content="https://gabrielpoca.com/2019-11-13-a-bit-more-lua-in-your-vim/index.html" property="og:url"><meta content="Gabriel Poça | A bit more lua in your vim" property="og:title"><meta content="A bit more lua in your vim" property="og:description"><meta content="https://gabrielpoca.com/https://gabrielpoca.com/2019-11-13-a-bit-more-lua-in-your-vim/seo.png" property="og:image"><meta content="summary_large_image" property="twitter:card"><meta content="https://gabrielpoca.com/2019-11-13-a-bit-more-lua-in-your-vim/index.html" property="twitter:url"><meta content="Gabriel Poça | A bit more lua in your vim" property="twitter:title"><meta content="A bit more lua in your vim" property="twitter:description"><meta content="https://gabrielpoca.com/https://gabrielpoca.com/2019-11-13-a-bit-more-lua-in-your-vim/seo.png" property="twitter:image"><link href="/icon.png" rel="icon" type="image/png"><meta content="text/html; charset=utf-8" http-equiv="Content-Type"><meta content="width=device-width, initial-scale=1.0" name="viewport"><link rel="stylesheet"  href="/global-LSjaseDdhYQReak1qfVEbw==.css" />
<link rel="stylesheet"  href="/site--Z1K36JV3z4XqzIgy-g8zw==.css" />
</head><body class="overscroll-none antialiased font-sans min-h-full h-full overflow-x-hidden w-full"><nav class="flex justify-end space-x-3 px-4 uppercase tracking-wide h-16 items-center z-40 relative text-xs font-bold md:px-8 md:space-x-4 md:text-sm text-my-purple"><a href="/" class="opacity-60">Home</a><a href="/books" class="opacity-60">Reading</a><a href="/music" class="opacity-60">Music</a><a href="/now" class="opacity-60">Now</a><a href="/about" class="opacity-60">About</a></nav><article class="bg-black text-my-white h-entry"><div class="text-center relative flex items-center justify-center -mt-16" style="height:80vh"><h1 class="p-name mb-8 text-4xl z-20 relative mx-auto px-8 sm:text-5xl sm:px-16">A bit more lua in your vim</h1></div><div class="mx-auto py-8 px-6 sm:max-w-screen-sm"><div class="prose max-w-none prose-lg e-content"><p>Following up on the <a href="https://gabrielpoca.com/2019-11-02-a-little-bit-of-lua-in-your-vim/">previous entry about lua in vim</a>, in this one I document other ways in which I used lua to improve my setup.</p><p>Anyone using Neovim should know that it has support for floating windows: real windows that can float around. You can do all kinds of cool stuff with it. Here it is in action:</p><blockquote class="twitter-tweet tw-align-center"><p lang="en" dir="ltr"><a href="https://twitter.com/hashtag/neovim?src=hash&amp;ref_src=twsrc%5Etfw">#neovim</a> floating window test with vim-iced (part 2)<br>Floating debugger info<a href="https://t.co/wAITDpmvip">https://t.co/wAITDpmvip</a><a href="https://twitter.com/hashtag/clojure?src=hash&amp;ref_src=twsrc%5Etfw">#clojure</a> <a href="https://t.co/5lebGKybiD">pic.twitter.com/5lebGKybiD</a></p>&mdash; 飯塚将志@にびいろClojure (@uochan) <a href="https://twitter.com/uochan/status/1101445517865771013?ref_src=twsrc%5Etfw">March 1, 2019</a></blockquote><p>So this is how the story begins: one day my friend, and teammate, <a href="https://twitter.com/naps62">Miguel</a> was showing me something on his computer, when I saw him doing something like this:</p><p><a href="https://asciinema.org/a/278565"><img src="https://asciinema.org/a/278565.svg" alt="asciicast" /></a></p><p>He was opening fzf inside a floating window! I immediately ran to my desk and copied the code that does this from his dotfiles. The relevant parts are <a href="https://github.com/naps62/dotfiles/blob/b6df1166ce3b65ab408147a58201aa9c2cccd691/config/nvim/rc/functions.vim#L69-L87">here</a> and <a href="https://github.com/naps62/dotfiles/blob/f5a3ed135ce210ae3b29268b6122cb5d863375cc/config/nvim/rc/plugins.vim#L226">here</a>. He got it somewhere from the Github.</p><p>I was in love with this for a while!… Until I realized that it didn’t work great when I was using Vim in smaller tmux splits. I need something more “intelligent” that took into account the editor’s size. Since my VimScript skills are non-existent, I replaced his implementation with Lua.</p><p>Here’s what I want:</p><ul><li>if the editor is small (when I’m in a split with 1/4 of the screen’s size) it uses a full window instead of a floating one.</li><li>the floating window’s width is 90% of the editor’s width, but if the editor’s width is small, it uses full width minus 4 columns from each side.</li><li>a floating window’s height is 3/4 of the editor’s height to a max of 30 lines.</li></ul><p>The code, with comments, so it’s easier to understand:</p><pre><code class="lua">function NavigationFloatingWin()
  -- get the editor&#39;s max width and height
  local width = vim.api.nvim_get_option(&quot;columns&quot;)
  local height = vim.api.nvim_get_option(&quot;lines&quot;)

  -- create a new, scratch buffer, for fzf
  local buf = vim.api.nvim_create_buf(false, true)
  vim.api.nvim_buf_set_option(buf, &#39;buftype&#39;, &#39;nofile&#39;)

  -- if the editor is big enough
  if (width &gt; 150 or height &gt; 35) then
    -- fzf&#39;s window height is 3/4 of the max height, but not more than 30
    local win_height = math.min(math.ceil(height * 3 / 4), 30)
    local win_width

    -- if the width is small
    if (width &lt; 150) then
      -- just subtract 8 from the editor&#39;s width
      win_width = math.ceil(width - 8)
    else
      -- use 90% of the editor&#39;s width
      win_width = math.ceil(width * 0.9)
    end

    -- settings for the fzf window
    local opts = {
      relative = &quot;editor&quot;,
      width = win_width,
      height = win_height,
      row = math.ceil((height - win_height) / 2),
      col = math.ceil((width - win_width) / 2)
    }

    -- create a new floating window, centered in the editor
    local win = vim.api.nvim_open_win(buf, true, opts)
  end
end</code></pre><p>To make it work, place the code in a file such as <code class="inline">~/.config/nvim/lua/navigation/init.lua</code>, and in your vim configuration put something like this:</p><pre><code class="vim">&quot; load lua functions for navigation
lua require(&quot;navigation&quot;)
let g:fzf_layout = { &#39;window&#39;: &#39;lua NavigationFloatingWin()&#39; }</code></pre><p>Once again, I know that you can do this with VimScript, but I can’t. And, because I know there are more like me out there, I hope this helps you, and my future self as well.</p></div></div><span class="h-card hidden p-author"><a class="p-name u-url" href="/" rel="author me">Gabriel Poça</a><a class="u-photo" href="/icon.png"></a><span class="p-note">Professional software engineer / amateur music maker / avid reader in the process of learning everything I can.</span></span><div class="hidden"><a class="u-url" href="/2019-11-13-a-bit-more-lua-in-your-vim/index.html">A bit more lua in your vim</a><time class="dt-published" datetime="2019-11-13T00:00:00-00:00">2019-11-13</time></div></article><footer class="py-20 items-end text-xs sm:text-sm bg-black"><div class="bg-my-purple mx-auto px-4 py-10 md:p-8 md:rounded md:container"><div class="flex flex-col sm:flex-row sm:flex-start"><div class="border-2 border-my-purple-darker rounded-full w-24 h-24 overflow-hidden flex-shrink-0 mb-4 sm:mx-auto sm:mb-0"><img src="/_includes/eu-41840077-400w.jpg" srcset="/_includes/eu-41840077-100w.jpg 100w, /_includes/eu-41840077-200w.jpg 200w, /_includes/eu-41840077-300w.jpg 300w, /_includes/eu-41840077-400w.jpg 400w" class="w-full h-full"/></div><div class="flex-grow sm:ml-8"><p class="font-bold mb-1">Hey! <br /> Thanks for stopping by.</p><p class="flex-grow">And feel free to reach out to me on <a href="https://twitter.com/gabrielgpoca" rel="noopener noreferrer" target="_blank" class="underline underline-current-color text-hover-none">Twitter</a> or <a class="underline underline-current-color text-hover-none" href="mailto:mail@gabrielpoca.com">e-mail</a>.<br />I'm always available to listen, talk, share, or brainstorm.</p><p class="flex-grow">For more information see the <a href="/about" class="underline underline-current-color text-hover-none">about page</a>.</p><p class="flex-grow">You can subscribe to this blog using <a href="/rss.xml" class="underline underline-current-color text-hover-none">RSS</a>.</p></div></div></div></footer><span class="h-card hidden p-author"><a class="p-name u-url" href="/" rel="author me">Gabriel Poça</a><a class="u-photo" href="/icon.png"></a><span class="p-note">Professional software engineer / amateur music maker / avid reader in the process of learning everything I can.</span></span><script data-goatcounter="https://gabrielpoca.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script><link href="https://github.com/gabrielpoca" rel="me" /><link rel="webmention" href="https://webmention.io/gabrielpoca.com/webmention" /><link rel="pingback" href="https://webmention.io/gabrielpoca.com/xmlrpc" /></body></html>