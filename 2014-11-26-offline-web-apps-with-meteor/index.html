<html class="min-h-full h-full w-full dark" lang="en"><head><title>Gabriel Poça | Offline Web Apps with Meteor</title><meta content="Gabriel Poça | Offline Web Apps with Meteor" name="title"><meta content="Offline Web Apps with Meteor" name="description"><meta content="website" property="og:type"><meta content="https://gabrielpoca.com/2014-11-26-offline-web-apps-with-meteor/index.html" property="og:url"><meta content="Gabriel Poça | Offline Web Apps with Meteor" property="og:title"><meta content="Offline Web Apps with Meteor" property="og:description"><meta content="https://gabrielpoca.com/https://gabrielpoca.com/2014-11-26-offline-web-apps-with-meteor/seo.png" property="og:image"><meta content="summary_large_image" property="twitter:card"><meta content="https://gabrielpoca.com/2014-11-26-offline-web-apps-with-meteor/index.html" property="twitter:url"><meta content="Gabriel Poça | Offline Web Apps with Meteor" property="twitter:title"><meta content="Offline Web Apps with Meteor" property="twitter:description"><meta content="https://gabrielpoca.com/https://gabrielpoca.com/2014-11-26-offline-web-apps-with-meteor/seo.png" property="twitter:image"><link href="/icon.png" rel="icon" type="image/png"><meta content="text/html; charset=utf-8" http-equiv="Content-Type"><meta content="width=device-width, initial-scale=1.0" name="viewport"><link rel="stylesheet"  href="/global-a3t2m3FQIGbduTQseQ2LOQ==.css" />
<link rel="stylesheet"  href="/site-mEL6LQbJJlCImN4ZkVYbKg==.css" />
</head><body class="overscroll-none antialiased font-sans min-h-full h-full overflow-x-hidden w-full bg-black-light text-my-white"><header class="flex justify-between px-4 md_px-8 items-center absolute top-0 left-0 w-full z-20 text-my-purple"><a href="/" class="flex items-center -mt-1"><img src="/_includes/me small-109857605-256w.png" srcset="/_includes/me small-109857605-64w.png 64w, /_includes/me small-109857605-128w.png 128w, /_includes/me small-109857605-192w.png 192w, /_includes/me small-109857605-256w.png 256w" class="w-8 mr-3"/><span class="invisible sm_visible text-sm font-bold">Gabriel Poça</span></a><nav class="flex justify-end space-x-2 sm_space-x-5 uppercase tracking-widest h-16 items-center z-10 relative text-xs font-bold"><a href="/" class="font-normal">Home</a><a href="/books" class="font-normal">Reading</a><a href="/music" class="font-normal">Music</a><a href="/now" class="font-normal">Now</a><a href="/about" class="font-normal">About</a></nav></header><article><div class="text-center relative flex items-center justify-center" style="height:85vh"><h1 class="mb-8 text-4xl font-bold z-20 relative px-8 max-w-screen-lg sm_text-5xl">Offline Web Apps with Meteor</h1></div><div class="container pb-32 pt-12"><h2 class="mb-6 section-heading">Blog Post</h2><div class="prose max-w-none prose-lg e-content"><p>This blog post was written for <a href="http://blog.groupbuddies.com/posts/45-offline-web-apps-with-meteor">Group Buddies Blog</a>.</p><p>In this blog post I’m presenting a solution to make Meteor apps work completely offline. In fact, Meteor apps already work offline, as long as the user doesn’t close the browser.</p><p>If you don’t know what Meteor is or how it works, I recommend that you take a look at the <a href="http://docs.meteor.com/#/basic/">meteor docs</a> before moving forward.</p><p>One of the principles of Meteor is “Data on the Wire”, i.e., each client receives all assets upon connection, after which only data is sent between the client and the server.</p><p>Another principle is “Database Everywhere”, i.e., each client has a subset of the server database that responds to the same operations with the same api.</p><p>When offline, a client has everything needed to keep the app running. This article focuses on how to allow a user to reopen the application, while being offline, after the browser has been closed.</p><h2>Persisting assets</h2><p>HTML5 made some progress in allowing web applications to be accessible offline. The result of it is the ApplicationCache interface. Since many people don’t know, or understand, <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Using_the_application_cache">AppCache</a>, here’s how it is defined in MDN (Mozilla Developer Network).</p><blockquote><p>Developers can use the Application Cache (AppCache) interface to specify resources that the browser should cache and make available to offline users. Applications that are cached load and work correctly even if users click the refresh button when they are offline.</p></blockquote><p>AppCache stores all the application assets and allows a user to open them when there is no internet connection. For more details on AppCache I recommend <a href="http://www.html5rocks.com/en/tutorials/appcache/beginner/">this guide</a>.</p><p>To start using AppCache on a Meteor application just add the package:</p><pre><code>meteor add appcache</code></pre><p>Don’t worry if the console logs say the app has more that 5 MB ( which is the recommended maximum). When Meteor builds for production it concatenates and minifies the assets. If it’s still more that 5 MB maybe you need to exclude some assets from AppCache.</p><p>For instance, you can tell AppCache not to save an image:</p><pre><code>Meteor.AppCache.config
  onlineOnly: [
    &#39;/bg.png&#39;
    ]</code></pre><p>The <a href="https://github.com/meteor/meteor/wiki/AppCache">documentation</a> is a good follow up on this topic.</p><h2>Persisting data</h2><p>The client side database is in-memory. When offline, Meteor will store both the current working database and a list of messages to send to the server on reconnect. There is no (official) way to persist this data to disk, and for this reason the information is lost when the browser is closed.</p><p>To overcome this limitation, there is <a href="https://github.com/GroundMeteor/db">GroundDB</a>, a fast and thin layer providing Meteor with offline database and methods, saving them into the <a href="https://developer.mozilla.org/en-US/docs/Web/Guide/API/DOM/Storage#localStorage"><code class="inline">localStorage</code></a>.</p><p>To start using GroundDB add the package.</p><pre><code>meteor add ground:db</code></pre><p>Now your subscriptions will be available when you’re offline. If you’re using IronRouter you should not use the <code class="inline">waitOn</code> feature, since this is going to make the application hold until the server responds. Instead, subscribe to the data you want offline on the application startup. For instance, in the file <code class="inline">lib/router.coffee</code> you can have something like the following:</p><pre><code>if Meteor.isClient
  subscribed = false
  Tracker.autorun () -&gt;
    if Meteor.user() &amp;&amp; !subscribed
      Meteor.subscribe &#39;users&#39;
      Meteor.subscribe &#39;trips&#39;
      Meteor.subscribe &#39;expenses&#39;
      Meteor.subscribe &#39;notifications&#39;
      subscribed = true</code></pre><p>This way the data will always be on <code class="inline">localStorage</code> when the user goes offline. This also means that you need to care about the amount of information that you save locally.</p><p>If you are interested in this topic, this <a href="https://groups.google.com/forum/#!searchin/meteor-talk/minimongo$20offline/meteor-talk/tGto0cCsvXA/dH3uZjEd9y4J">google groups thread</a> is a good follow up.</p><h2>Summary</h2><p>Making an offline web application requires a different ways of thinking about a solution, and there are many plenty problems to solve. These packages help pushing forward on making offline web applications. Feel free to ask questions, I’m not an expert but I’ll try my best to answer.</p><p>As an example, you can run <a href="https://github.com/groupbuddies/tripl.it.git">tripl.it</a> and see it’s source code. It’s a mobile application that works offline.</p></div></div></article><div class="h-4 bg-fuchsia-darker w-full"></div><div class="h-4 bg-fuchsia-dark w-full"></div><footer class="relative flex footer-bg-color text-sm"><img src="/_includes/footer/bg-27398931-11568w.jpg" srcset="/_includes/footer/bg-27398931-2892w.jpg 2892w, /_includes/footer/bg-27398931-5784w.jpg 5784w, /_includes/footer/bg-27398931-8676w.jpg 8676w, /_includes/footer/bg-27398931-11568w.jpg 11568w" class="absolute bottom-0 left-0 h-full object-left-bottom w-full object-cover xl_object-contain"/><div class="relative container pt-28 pb-52 sm_pt-40 sm_pb-60"><p class="font-bold mb-1">Hey! <br /> Thanks for stopping by.</p><p class="flex-grow">And feel free to reach out to me on <a href="https://twitter.com/gabrielgpoca" rel="noopener noreferrer" target="_blank" class="underline underline-current-color text-hover-none">Twitter</a> or <a class="underline underline-current-color text-hover-none" href="mailto:mail@gabrielpoca.com">e-mail</a>.<br />I'm always available to listen, talk, share, or brainstorm.</p><p class="flex-grow">For more information see the <a href="/about" class="underline underline-current-color text-hover-none">about page</a>.</p><p class="flex-grow">You can subscribe to this blog using <a href="/rss.xml" class="underline underline-current-color text-hover-none">RSS</a>.</p></div></footer><script data-goatcounter="https://gabrielpoca.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script></body></html>