<html class="min-h-full h-full w-full" lang="en"><head><title>Gabriel Poça | Offline Web Apps with Meteor</title><meta content="Gabriel Poça | Offline Web Apps with Meteor" name="title"><meta content="Offline Web Apps with Meteor" name="description"><meta content="website" property="og:type"><meta content="https://gabrielpoca.com/2014-11-26-offline-web-apps-with-meteor/index.html" property="og:url"><meta content="Gabriel Poça | Offline Web Apps with Meteor" property="og:title"><meta content="Offline Web Apps with Meteor" property="og:description"><meta content="https://gabrielpoca.com/https://gabrielpoca.com/2014-11-26-offline-web-apps-with-meteor/seo.png" property="og:image"><meta content="summary_large_image" property="twitter:card"><meta content="https://gabrielpoca.com/2014-11-26-offline-web-apps-with-meteor/index.html" property="twitter:url"><meta content="Gabriel Poça | Offline Web Apps with Meteor" property="twitter:title"><meta content="Offline Web Apps with Meteor" property="twitter:description"><meta content="https://gabrielpoca.com/https://gabrielpoca.com/2014-11-26-offline-web-apps-with-meteor/seo.png" property="twitter:image"><link href="/icon.png" rel="icon" type="image/png"><meta content="text/html; charset=utf-8" http-equiv="Content-Type"><meta content="width=device-width, initial-scale=1.0" name="viewport"><link rel="stylesheet"  href="/global-LSjaseDdhYQReak1qfVEbw==.css" />
<link rel="stylesheet"  href="/site--Z1K36JV3z4XqzIgy-g8zw==.css" />
</head><body class="overscroll-none antialiased font-sans min-h-full h-full overflow-x-hidden w-full"><nav class="flex justify-end space-x-3 px-4 uppercase tracking-wide h-16 items-center z-40 relative text-xs font-bold md:px-8 md:space-x-4 md:text-sm text-my-purple"><a href="/" class="opacity-60">Home</a><a href="/books" class="opacity-60">Reading</a><a href="/music" class="opacity-60">Music</a><a href="/now" class="opacity-60">Now</a><a href="/about" class="opacity-60">About</a></nav><article class="bg-black text-my-white h-entry"><div class="text-center relative flex items-center justify-center -mt-16" style="height:80vh"><h1 class="p-name mb-8 text-4xl z-20 relative mx-auto px-8 sm:text-5xl sm:px-16">Offline Web Apps with Meteor</h1></div><div class="mx-auto py-8 px-6 sm:max-w-screen-sm"><div class="prose max-w-none prose-lg e-content"><p>This blog post was written for <a href="http://blog.groupbuddies.com/posts/45-offline-web-apps-with-meteor">Group Buddies Blog</a>.</p><p>In this blog post I’m presenting a solution to make Meteor apps work completely offline. In fact, Meteor apps already work offline, as long as the user doesn’t close the browser.</p><p>If you don’t know what Meteor is or how it works, I recommend that you take a look at the <a href="http://docs.meteor.com/#/basic/">meteor docs</a> before moving forward.</p><p>One of the principles of Meteor is “Data on the Wire”, i.e., each client receives all assets upon connection, after which only data is sent between the client and the server.</p><p>Another principle is “Database Everywhere”, i.e., each client has a subset of the server database that responds to the same operations with the same api.</p><p>When offline, a client has everything needed to keep the app running. This article focuses on how to allow a user to reopen the application, while being offline, after the browser has been closed.</p><h2>Persisting assets</h2><p>HTML5 made some progress in allowing web applications to be accessible offline. The result of it is the ApplicationCache interface. Since many people don’t know, or understand, <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Using_the_application_cache">AppCache</a>, here’s how it is defined in MDN (Mozilla Developer Network).</p><blockquote><p>Developers can use the Application Cache (AppCache) interface to specify resources that the browser should cache and make available to offline users. Applications that are cached load and work correctly even if users click the refresh button when they are offline.</p></blockquote><p>AppCache stores all the application assets and allows a user to open them when there is no internet connection. For more details on AppCache I recommend <a href="http://www.html5rocks.com/en/tutorials/appcache/beginner/">this guide</a>.</p><p>To start using AppCache on a Meteor application just add the package:</p><pre><code>meteor add appcache</code></pre><p>Don’t worry if the console logs say the app has more that 5 MB ( which is the recommended maximum). When Meteor builds for production it concatenates and minifies the assets. If it’s still more that 5 MB maybe you need to exclude some assets from AppCache.</p><p>For instance, you can tell AppCache not to save an image:</p><pre><code>Meteor.AppCache.config
  onlineOnly: [
    &#39;/bg.png&#39;
    ]</code></pre><p>The <a href="https://github.com/meteor/meteor/wiki/AppCache">documentation</a> is a good follow up on this topic.</p><h2>Persisting data</h2><p>The client side database is in-memory. When offline, Meteor will store both the current working database and a list of messages to send to the server on reconnect. There is no (official) way to persist this data to disk, and for this reason the information is lost when the browser is closed.</p><p>To overcome this limitation, there is <a href="https://github.com/GroundMeteor/db">GroundDB</a>, a fast and thin layer providing Meteor with offline database and methods, saving them into the <a href="https://developer.mozilla.org/en-US/docs/Web/Guide/API/DOM/Storage#localStorage"><code class="inline">localStorage</code></a>.</p><p>To start using GroundDB add the package.</p><pre><code>meteor add ground:db</code></pre><p>Now your subscriptions will be available when you’re offline. If you’re using IronRouter you should not use the <code class="inline">waitOn</code> feature, since this is going to make the application hold until the server responds. Instead, subscribe to the data you want offline on the application startup. For instance, in the file <code class="inline">lib/router.coffee</code> you can have something like the following:</p><pre><code>if Meteor.isClient
  subscribed = false
  Tracker.autorun () -&gt;
    if Meteor.user() &amp;&amp; !subscribed
      Meteor.subscribe &#39;users&#39;
      Meteor.subscribe &#39;trips&#39;
      Meteor.subscribe &#39;expenses&#39;
      Meteor.subscribe &#39;notifications&#39;
      subscribed = true</code></pre><p>This way the data will always be on <code class="inline">localStorage</code> when the user goes offline. This also means that you need to care about the amount of information that you save locally.</p><p>If you are interested in this topic, this <a href="https://groups.google.com/forum/#!searchin/meteor-talk/minimongo$20offline/meteor-talk/tGto0cCsvXA/dH3uZjEd9y4J">google groups thread</a> is a good follow up.</p><h2>Summary</h2><p>Making an offline web application requires a different ways of thinking about a solution, and there are many plenty problems to solve. These packages help pushing forward on making offline web applications. Feel free to ask questions, I’m not an expert but I’ll try my best to answer.</p><p>As an example, you can run <a href="https://github.com/groupbuddies/tripl.it.git">tripl.it</a> and see it’s source code. It’s a mobile application that works offline.</p></div></div><span class="h-card hidden p-author"><a class="p-name u-url" href="/" rel="author me">Gabriel Poça</a><a class="u-photo" href="/icon.png"></a><span class="p-note">Professional software engineer / amateur music maker / avid reader in the process of learning everything I can.</span></span><div class="hidden"><a class="u-url" href="/2014-11-26-offline-web-apps-with-meteor/index.html">Offline Web Apps with Meteor</a><time class="dt-published" datetime="2014-11-26T00:00:00-00:00">2014-11-26</time></div></article><footer class="py-20 items-end text-xs sm:text-sm bg-black"><div class="bg-my-purple mx-auto px-4 py-10 md:p-8 md:rounded md:container"><div class="flex flex-col sm:flex-row sm:flex-start"><div class="border-2 border-my-purple-darker rounded-full w-24 h-24 overflow-hidden flex-shrink-0 mb-4 sm:mx-auto sm:mb-0"><img src="/_includes/eu-41840077-400w.jpg" srcset="/_includes/eu-41840077-100w.jpg 100w, /_includes/eu-41840077-200w.jpg 200w, /_includes/eu-41840077-300w.jpg 300w, /_includes/eu-41840077-400w.jpg 400w" class="w-full h-full"/></div><div class="flex-grow sm:ml-8"><p class="font-bold mb-1">Hey! <br /> Thanks for stopping by.</p><p class="flex-grow">And feel free to reach out to me on <a href="https://twitter.com/gabrielgpoca" rel="noopener noreferrer" target="_blank" class="underline underline-current-color text-hover-none">Twitter</a> or <a class="underline underline-current-color text-hover-none" href="mailto:mail@gabrielpoca.com">e-mail</a>.<br />I'm always available to listen, talk, share, or brainstorm.</p><p class="flex-grow">For more information see the <a href="/about" class="underline underline-current-color text-hover-none">about page</a>.</p><p class="flex-grow">You can subscribe to this blog using <a href="/rss.xml" class="underline underline-current-color text-hover-none">RSS</a>.</p></div></div></div></footer><span class="h-card hidden p-author"><a class="p-name u-url" href="/" rel="author me">Gabriel Poça</a><a class="u-photo" href="/icon.png"></a><span class="p-note">Professional software engineer / amateur music maker / avid reader in the process of learning everything I can.</span></span><script data-goatcounter="https://gabrielpoca.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script><link href="https://github.com/gabrielpoca" rel="me" /><link rel="webmention" href="https://webmention.io/gabrielpoca.com/webmention" /><link rel="pingback" href="https://webmention.io/gabrielpoca.com/xmlrpc" /></body></html>