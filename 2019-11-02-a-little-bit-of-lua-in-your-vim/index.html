<html class="min-h-full h-full w-full" lang="en"><head><title>Gabriel Poça | A little bit of lua in your vim</title><meta content="Gabriel Poça | A little bit of lua in your vim" name="title"><meta content="A little bit of lua in your vim" name="description"><meta content="website" property="og:type"><meta content="https://gabrielpoca.com/2019-11-02-a-little-bit-of-lua-in-your-vim/index.html" property="og:url"><meta content="Gabriel Poça | A little bit of lua in your vim" property="og:title"><meta content="A little bit of lua in your vim" property="og:description"><meta content="https://gabrielpoca.com/https://gabrielpoca.com/2019-11-02-a-little-bit-of-lua-in-your-vim/seo.png" property="og:image"><meta content="summary_large_image" property="twitter:card"><meta content="https://gabrielpoca.com/2019-11-02-a-little-bit-of-lua-in-your-vim/index.html" property="twitter:url"><meta content="Gabriel Poça | A little bit of lua in your vim" property="twitter:title"><meta content="A little bit of lua in your vim" property="twitter:description"><meta content="https://gabrielpoca.com/https://gabrielpoca.com/2019-11-02-a-little-bit-of-lua-in-your-vim/seo.png" property="twitter:image"><link href="/icon.png" rel="icon" type="image/png"><meta content="text/html; charset=utf-8" http-equiv="Content-Type"><meta content="width=device-width, initial-scale=1.0" name="viewport"><link rel="stylesheet"  href="/global-LSjaseDdhYQReak1qfVEbw==.css" />
<link rel="stylesheet"  href="/site--Z1K36JV3z4XqzIgy-g8zw==.css" />
</head><body class="overscroll-none antialiased font-sans min-h-full h-full overflow-x-hidden w-full"><nav class="flex justify-end space-x-3 px-4 uppercase tracking-wide h-16 items-center z-40 relative text-xs font-bold md:px-8 md:space-x-4 md:text-sm text-my-purple"><a href="/" class="opacity-60">Home</a><a href="/books" class="opacity-60">Reading</a><a href="/music" class="opacity-60">Music</a><a href="/now" class="opacity-60">Now</a><a href="/about" class="opacity-60">About</a></nav><article class="bg-black text-my-white h-entry"><div class="text-center relative flex items-center justify-center -mt-16" style="height:80vh"><h1 class="p-name mb-8 text-4xl z-20 relative mx-auto px-8 sm:text-5xl sm:px-16">A little bit of lua in your vim</h1></div><div class="mx-auto py-8 px-6 sm:max-w-screen-sm"><div class="prose max-w-none prose-lg e-content"><p>One of the reasons why I love Vim so much is because I can easily change it to my needs. My Vim configuration is a living organism that evolves with my knowledge, taste and career.</p><p>Unfortunately, VimScript never clicked for me, so whenever I needed to do something more complex in Vim, I would <a href="https://gabrielpoca.com/2017-09-04-vim-ruby/">rely in other languages, like Ruby</a>. This has worked reasonably well for me, but since Neovim <a href="https://neovim.io/roadmap/">added built-in support for a lua</a>, I’ve been waiting to have the time, and the use-case, to try it out.</p><p>This is what I want to accomplish: four shortcuts that open up four different neovim terminals. Whenever I hit one of the shortcuts, I get a new terminal. If this terminal was already created, I want to open it instead. I also don’t want to see these terminals in my buffer list.</p><p>This is something I already have with tmux, but the ergonomics are a bit weird. Doing it in neovim would be great for my workflow, but that’s not the topic of this blog post. On with the code.</p><p>The following piece of code is everything there is. I added some comments to make it easier to understand.</p><pre><code class="lua">-- to save terminals
list_of_terms = {}

function Terminal(nr, ...)
  -- if the terminal with nr exists, set the current buffer to it
  if list_of_terms[nr] then
    -- change to the terminal
    vim.api.nvim_set_current_buf(list_of_terms[nr])
  -- if the terminal doesn&#39;t exist
  else
    -- create a buffer that&#39;s is unlisted and not a scratch buffer
    local buf = vim.api.nvim_create_buf(false, false)
    -- change to that buffer
    vim.api.nvim_set_current_buf(buf)
    -- create a terinal in the new buffer using my favorite shell
    vim.api.nvim_call_function(&quot;termopen&quot;, {&quot;/bin/zsh&quot;})
    -- save a reference to that buffer
    list_of_terms[nr] = buf
  end
  -- change to insert mode
  vim.api.nvim_command(&quot;:startinsert&quot;)
end</code></pre><p>I save this code in <code class="inline">~/.config/nvim/lua/navigation/init.lua</code>. Now, in one of my Vim configuration files, I import the lua navigation package, and map the function created in Lua to the shortcuts.</p><pre><code class="vim">&quot; require the lua module
lua require(&quot;navigation&quot;)
&quot; map the Terminal function in the lua module to some shortcuts
nnoremap &lt;silent&gt; &lt;leader&gt;kh :lua Terminal(1)&lt;cr&gt;
nnoremap &lt;silent&gt; &lt;leader&gt;kj :lua Terminal(2)&lt;cr&gt;
nnoremap &lt;silent&gt; &lt;leader&gt;kk :lua Terminal(3)&lt;cr&gt;
nnoremap &lt;silent&gt; &lt;leader&gt;kl :lua Terminal(4)&lt;cr&gt;</code></pre><p>That is all! One of my ideas to improve this is changing of the shortcuts to immediately open up programs that I used more frequently. For that I could change the function to accept a new argument to use instead of <code class="inline">/bin/zsh</code>. I could do something like <code class="inline">nnoremap &lt;silent&gt; &lt;leader&gt;kl :lua Terminal(2, &quot;tig&quot;)</code> to get <em>tig</em>.</p><p>I’m sharing this not because this is a great use-case to use lua, I’m sure you can do this easily with VimScript (I can’t), but because it wasn’t easy to figure out which functions to call and how. I hope F˝ helps someone (or my future self).</p></div></div><span class="h-card hidden p-author"><a class="p-name u-url" href="/" rel="author me">Gabriel Poça</a><a class="u-photo" href="/icon.png"></a><span class="p-note">Professional software engineer / amateur music maker / avid reader in the process of learning everything I can.</span></span><div class="hidden"><a class="u-url" href="/2019-11-02-a-little-bit-of-lua-in-your-vim/index.html">A little bit of lua in your vim</a><time class="dt-published" datetime="2019-11-02T00:00:00-00:00">2019-11-02</time></div></article><footer class="py-20 items-end text-xs sm:text-sm bg-black"><div class="bg-my-purple mx-auto px-4 py-10 md:p-8 md:rounded md:container"><div class="flex flex-col sm:flex-row sm:flex-start"><div class="border-2 border-my-purple-darker rounded-full w-24 h-24 overflow-hidden flex-shrink-0 mb-4 sm:mx-auto sm:mb-0"><img src="/_includes/eu-41840077-400w.jpg" srcset="/_includes/eu-41840077-100w.jpg 100w, /_includes/eu-41840077-200w.jpg 200w, /_includes/eu-41840077-300w.jpg 300w, /_includes/eu-41840077-400w.jpg 400w" class="w-full h-full"/></div><div class="flex-grow sm:ml-8"><p class="font-bold mb-1">Hey! <br /> Thanks for stopping by.</p><p class="flex-grow">And feel free to reach out to me on <a href="https://twitter.com/gabrielgpoca" rel="noopener noreferrer" target="_blank" class="underline underline-current-color text-hover-none">Twitter</a> or <a class="underline underline-current-color text-hover-none" href="mailto:mail@gabrielpoca.com">e-mail</a>.<br />I'm always available to listen, talk, share, or brainstorm.</p><p class="flex-grow">For more information see the <a href="/about" class="underline underline-current-color text-hover-none">about page</a>.</p><p class="flex-grow">You can subscribe to this blog using <a href="/rss.xml" class="underline underline-current-color text-hover-none">RSS</a>.</p></div></div></div></footer><span class="h-card hidden p-author"><a class="p-name u-url" href="/" rel="author me">Gabriel Poça</a><a class="u-photo" href="/icon.png"></a><span class="p-note">Professional software engineer / amateur music maker / avid reader in the process of learning everything I can.</span></span><script data-goatcounter="https://gabrielpoca.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script><link href="https://github.com/gabrielpoca" rel="me" /><link rel="webmention" href="https://webmention.io/gabrielpoca.com/webmention" /><link rel="pingback" href="https://webmention.io/gabrielpoca.com/xmlrpc" /></body></html>