<html class="min-h-full h-full w-full dark" lang="en"><head><title>Gabriel Poça | A little bit of lua in your vim</title><meta content="Gabriel Poça | A little bit of lua in your vim" name="title"><meta content="A little bit of lua in your vim" name="description"><meta content="website" property="og:type"><meta content="https://gabrielpoca.com/2019-11-02-a-little-bit-of-lua-in-your-vim/index.html" property="og:url"><meta content="Gabriel Poça | A little bit of lua in your vim" property="og:title"><meta content="A little bit of lua in your vim" property="og:description"><meta content="https://gabrielpoca.com/https://gabrielpoca.com/2019-11-02-a-little-bit-of-lua-in-your-vim/seo.png" property="og:image"><meta content="summary_large_image" property="twitter:card"><meta content="https://gabrielpoca.com/2019-11-02-a-little-bit-of-lua-in-your-vim/index.html" property="twitter:url"><meta content="Gabriel Poça | A little bit of lua in your vim" property="twitter:title"><meta content="A little bit of lua in your vim" property="twitter:description"><meta content="https://gabrielpoca.com/https://gabrielpoca.com/2019-11-02-a-little-bit-of-lua-in-your-vim/seo.png" property="twitter:image"><link href="/icon.png" rel="icon" type="image/png"><meta content="text/html; charset=utf-8" http-equiv="Content-Type"><meta content="width=device-width, initial-scale=1.0" name="viewport"><link rel="stylesheet"  href="/global-4o-YP5JaY5pUORpLfbaOEw==.css" />
<link rel="stylesheet"  href="/site-mEL6LQbJJlCImN4ZkVYbKg==.css" />
</head><body class="overscroll-none antialiased font-sans min-h-full h-full overflow-x-hidden w-full bg-black-light text-my-white text-base"><header class="flex justify-between px-4 md_px-8 items-center absolute top-0 left-0 w-full z-20 text-my-white"><a href="/" class="flex items-center -mt-1"><img src="/_includes/me small-109857605-256w.png" srcset="/_includes/me small-109857605-64w.png 64w, /_includes/me small-109857605-128w.png 128w, /_includes/me small-109857605-192w.png 192w, /_includes/me small-109857605-256w.png 256w" class="w-8 mr-3"/><span class="invisible sm_visible text-sm font-bold">Gabriel Poça</span></a><nav class="flex justify-end space-x-2 sm_space-x-5 uppercase tracking-widest h-16 items-center z-10 relative text-xs font-bold sm_text-sm"><a href="/" class="font-normal hidden md_block">Home</a><a href="/books" class="font-normal">Reading</a><a href="/music" class="font-normal">Music</a><a href="/now" class="font-normal">Now</a><a href="/about" class="font-normal">About</a></nav></header><article><div class="text-center relative flex items-center justify-center" style="height:85vh"><h1 class="mb-8 text-4xl font-bold z-20 relative px-8 max-w-screen-lg sm_text-5xl">A little bit of lua in your vim</h1></div><div class="container pb-32 pt-12"><h2 class="mb-6 section-heading">Blog Post</h2><div class="prose max-w-none prose-lg e-content"><p>One of the reasons why I love Vim so much is because I can easily change it to my needs. My Vim configuration is a living organism that evolves with my knowledge, taste and career.</p><p>Unfortunately, VimScript never clicked for me, so whenever I needed to do something more complex in Vim, I would <a href="https://gabrielpoca.com/2017-09-04-vim-ruby/">rely in other languages, like Ruby</a>. This has worked reasonably well for me, but since Neovim <a href="https://neovim.io/roadmap/">added built-in support for a lua</a>, I’ve been waiting to have the time, and the use-case, to try it out.</p><p>This is what I want to accomplish: four shortcuts that open up four different neovim terminals. Whenever I hit one of the shortcuts, I get a new terminal. If this terminal was already created, I want to open it instead. I also don’t want to see these terminals in my buffer list.</p><p>This is something I already have with tmux, but the ergonomics are a bit weird. Doing it in neovim would be great for my workflow, but that’s not the topic of this blog post. On with the code.</p><p>The following piece of code is everything there is. I added some comments to make it easier to understand.</p><pre><code class="lua">-- to save terminals
list_of_terms = {}

function Terminal(nr, ...)
  -- if the terminal with nr exists, set the current buffer to it
  if list_of_terms[nr] then
    -- change to the terminal
    vim.api.nvim_set_current_buf(list_of_terms[nr])
  -- if the terminal doesn&#39;t exist
  else
    -- create a buffer that&#39;s is unlisted and not a scratch buffer
    local buf = vim.api.nvim_create_buf(false, false)
    -- change to that buffer
    vim.api.nvim_set_current_buf(buf)
    -- create a terinal in the new buffer using my favorite shell
    vim.api.nvim_call_function(&quot;termopen&quot;, {&quot;/bin/zsh&quot;})
    -- save a reference to that buffer
    list_of_terms[nr] = buf
  end
  -- change to insert mode
  vim.api.nvim_command(&quot;:startinsert&quot;)
end</code></pre><p>I save this code in <code class="inline">~/.config/nvim/lua/navigation/init.lua</code>. Now, in one of my Vim configuration files, I import the lua navigation package, and map the function created in Lua to the shortcuts.</p><pre><code class="vim">&quot; require the lua module
lua require(&quot;navigation&quot;)
&quot; map the Terminal function in the lua module to some shortcuts
nnoremap &lt;silent&gt; &lt;leader&gt;kh :lua Terminal(1)&lt;cr&gt;
nnoremap &lt;silent&gt; &lt;leader&gt;kj :lua Terminal(2)&lt;cr&gt;
nnoremap &lt;silent&gt; &lt;leader&gt;kk :lua Terminal(3)&lt;cr&gt;
nnoremap &lt;silent&gt; &lt;leader&gt;kl :lua Terminal(4)&lt;cr&gt;</code></pre><p>That is all! One of my ideas to improve this is changing of the shortcuts to immediately open up programs that I used more frequently. For that I could change the function to accept a new argument to use instead of <code class="inline">/bin/zsh</code>. I could do something like <code class="inline">nnoremap &lt;silent&gt; &lt;leader&gt;kl :lua Terminal(2, &quot;tig&quot;)</code> to get <em>tig</em>.</p><p>I’m sharing this not because this is a great use-case to use lua, I’m sure you can do this easily with VimScript (I can’t), but because it wasn’t easy to figure out which functions to call and how. I hope F˝ helps someone (or my future self).</p></div></div></article><div class="h-4 bg-fuchsia-darker w-full"></div><div class="h-4 bg-fuchsia-dark w-full"></div><footer class="relative flex footer-bg-color"><img src="/_includes/footer/bg-27398931-11568w.jpg" srcset="/_includes/footer/bg-27398931-2892w.jpg 2892w, /_includes/footer/bg-27398931-5784w.jpg 5784w, /_includes/footer/bg-27398931-8676w.jpg 8676w, /_includes/footer/bg-27398931-11568w.jpg 11568w" class="absolute bottom-0 left-0 h-full object-left-bottom w-full object-cover xl_object-contain"/><div class="relative container pt-28 pb-52 sm_pt-40 sm_pb-60"><p class="font-bold mb-2">Hey! <br /> Thanks for stopping by.</p><p class="flex-grow mb-2">And feel free to reach out to me on <a href="https://twitter.com/gabrielgpoca" rel="noopener noreferrer" target="_blank" class="underline underline-current-color text-hover-none">Twitter</a> or <a class="underline underline-current-color text-hover-none" href="mailto:mail@gabrielpoca.com">e-mail</a>.<br />I'm always available to listen, talk, share, or brainstorm.</p><p class="flex-grow mb-2">For more information see the <a href="/about" class="underline underline-current-color text-hover-none">about page</a>.</p><p class="flex-grow">You can subscribe to this blog using <a href="/rss.xml" class="underline underline-current-color text-hover-none">RSS</a>.</p></div></footer><script data-goatcounter="https://gabrielpoca.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script></body></html>